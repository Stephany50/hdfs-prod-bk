INSERT INTO CDR.SPARK_IT_OMNY_BalanceSubscribers PARTITION (ORIGINAL_FILE_DATE)
SELECT
ORIGINAL_FILE_NAME         ,
ORIGINAL_FILE_SIZE         ,
ORIGINAL_FILE_LINE_COUNT   ,
CATEGORY_CODE              ,
USER_ID                    ,
WALLET_NUMBER              ,
MSISDN                     ,
PARENT_USER_ID             ,
PARENT_MSISDN              ,
OWNER_USER_ID              ,
OWNER_MSISDN               ,
OPENING_BALANCE            ,
CLOSING_BALANCE            ,
AMT_TRANS_OUT              ,
NB_TRANS_OUT               ,
AMT_TRANS_IN               ,
NB_TRANS_IN                ,
AMT_TRANS_REIMB_OUT        ,
NB_TRANS_REIMB_OUT         ,
AMT_TRANS_REIMB_IN         ,
NB_TRANS_REIMB_IN          ,
AMT_SC_OUT                 ,
NB_SC_OUT                  ,
AMT_SC_IN                  ,
NB_SC_IN                   ,
AMT_COM_OUT                ,
NB_COM_OUT                 ,
AMT_COM_IN                 ,
NB_COM_IN                  ,
AMT_COM_REIMB_OUT          ,
NB_COM_REIMB_OUT           ,
AMT_COM_REIMB_IN           ,
NB_COM_REIMB_IN            ,
AMT_COM_OUT_OTHER          ,
NB_COM_OUT_OTHER           ,
AMT_COM_IN_OTHER           ,
NB_COM_IN_OTHER            ,
AMT_COM_REIMB_OUT_OTHER    ,
NB_COM_REIMB_OUT_OTHER     ,
AMT_COM_REIMB_IN_OTHER     ,
NB_COM_REIMB_IN_OTHER      ,
NB_NONFIN_TRANS            ,
NB_NONFIN_TRANS_CANCELLED  ,
AMT_SC_NONFIN_OUT          ,
NB_SC_NONFIN_OUT           ,
AMT_SC_NONFIN_IN           ,
NB_SC_NONFIN_IN            ,
AMT_COM_NONFIN_OUT         ,
NB_COM_NONFIN_OUT          ,
AMT_COM_NONFIN_IN          ,
NB_COM_NONFIN_IN           ,
AMT_TOTAL_OUT              ,
NB_TOTAL_OUT               ,
AMT_TOTAL_IN               ,
NB_TOTAL_IN                ,
CURRENT_TIMESTAMP() INSERT_DATE,
TO_DATE(FROM_UNIXTIME(UNIX_TIMESTAMP(SUBSTRING (ORIGINAL_FILE_NAME, -12, 8),'yyyyMMdd'))) ORIGINAL_FILE_DATE
FROM CDR.TT_OMNY_BalanceSubscribers C
LEFT JOIN (SELECT DISTINCT original_file_name FILE_NAME FROM CDR.SPARK_IT_OMNY_BalanceSubscribers) T ON T.file_name = C.original_file_name
WHERE  T.file_name IS NULL;
