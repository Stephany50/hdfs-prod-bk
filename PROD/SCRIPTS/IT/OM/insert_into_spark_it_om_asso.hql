INSERT into cdr.spark_it_om_asso
SELECT
       ID ,
       MSISDN ,
       BUSINESS_OWNER_FNAME  ,
       BUSINESS_OWNER_LNAME  ,
       BUSINESS_OWNER_IDNUMBER  ,
       BUSINESS_OWNER_BIRTHDATE ,
       BUSINESS_OWNER_GRADE ,
       BUSINESS_NAME ,
       BUSINESS_COM_NAME ,
       BUSINESS_DESC ,
       BUSINESS_TOWN_LOCATION  ,
       BUSINESS_DISTRICT_LOCATION ,
       BUSINESS_OWNER_IDENTIFICATION  ,
       BUSINESS_AGENT_ID  ,
       BUSINESS_AGENT_APPROVAL_STATUS ,
       TRANSACTION_AMOUNT ,
       TRANSACTION_ID ,
       TRANSACTION_STATUS  ,
       REGISTRATION_STATUS  ,
       REGISTRATION_MESSAGE  ,
       RECEPTION_BUSINESS_DOC_STATUS  ,
       VALIDATION_MESSAGE  ,
       VALIDATION_STATUS ,
       LANG ,
       CANAL ,
       CREATED_AT  ,
       UPDATED_AT ,
       ORIGINAL_FILE_NAME ,
       CURRENT_TIMESTAMP() INSERT_DATE ,
       ORIGINAL_FILE_SIZE ,
       ORIGINAL_FILE_LINE_COUNT,
       FROM_UNIXTIME(UNIX_(SUBSTRING (ORIGINAL_FILE_NAME, -18, 8),'yyyyMMdd')) FILE_DATE
FROM   cdr.tt_om_asso C
LEFT JOIN (SELECT DISTINCT  ORIGINAL_FILE_NAME FILE_NAME FROM CDR.SPARK_IT_OM_ASSO WHERE FILE_DATE BETWEEN DATE_SUB(CURRENT_DATE,${hivevar:date_offset}) AND CURRENT_DATE )T ON T.FILE_NAME=C.ORIGINAL_FILE_NAME
WHERE T.FILE_NAME IS NULL