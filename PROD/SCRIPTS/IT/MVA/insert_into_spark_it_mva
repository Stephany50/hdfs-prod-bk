INSERT INTO cdr.spark_it_mva PARTITION (targetcalldate,ORIGINAL_FILE_DATE)
SELECT
  callid , 
  msisdn ,
  targetCall ,
  targetcalltime , 
  versionId ,
  label ,
  lastcalldate , 
  lastcalltime ,
  nbretries , 
  lastcallstatus ,
  lastcallduration , 
  qualificationId ,
  requalifdate, 
  qualificationfinalid ,
  reason , 
  uid ,
  menuidAa , 
  choiceidAa ,
  menuidBb , 
  choiceidBb ,
  menuidCc , 
  choiceidCc ,
  don11 , 
  don22 , 
  don33 ,
  don44 , 
  don55 , 
  don66 ,
  don77 , 
  don88 , 
  don99 ,
  reasoncomments , 
  FileName,
  CURRENT_TIMESTAMP() INSERT_DATE,
  ORIGINAL_FILE_NAME,
  ORIGINAL_FILE_SIZE,
  ORIGINAL_FILE_LINE_COUNT,
  targetcalldate,
  TO_DATE(FROM_UNIXTIME(UNIX_TIMESTAMP(SUBSTRING (ORIGINAL_FILE_NAME, -18, 8),'yyyyMMdd'))) ORIGINAL_FILE_DATE
FROM cdr.tt_mva C
LEFT JOIN (SELECT DISTINCT  ORIGINAL_FILE_NAME FILE_NAME FROM cdr.spark_it_mva WHERE ORIGINAL_FILE_DATE BETWEEN DATE_SUB(CURRENT_DATE,3) AND CURRENT_DATE )T ON T.FILE_NAME=C.ORIGINAL_FILE_NAME
WHERE T.FILE_NAME IS NULL
