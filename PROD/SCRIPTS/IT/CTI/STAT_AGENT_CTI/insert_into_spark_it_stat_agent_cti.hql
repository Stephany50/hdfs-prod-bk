INSERT INTO CTI.IT_STAT_AGENT_CTI
SELECT
INTERACTION_ID,
TO_DATE(FROM_UNIXTIME(UNIX_TIMESTAMP(START_TIME, 'dd/MM/yyyy HH:mm:ss'))) START_TIME,
TO_DATE(FROM_UNIXTIME(UNIX_TIMESTAMP(END_TIME_TS, 'dd/MM/yyyy HH:mm:ss'))) END_TIME_TS,
INTERACTION_TYPE,
MSIDSN,
TO_DATE(FROM_UNIXTIME(UNIX_TIMESTAMP(DATE_TIME_AGG, 'dd/MM/yyyy HH:mm:ss'))) DATE_TIME_AGG,
TO_DATE(FROM_UNIXTIME(UNIX_TIMESTAMP(ThirtyMinAgg, 'dd/MM/yyyy HH:mm:ss'))) ThirtyMinAgg,
RESOURCES,
RESOURCE_TYPE,
RESOURCE_SUBTYPE,
AGENT_FIRST_NAME,
AGENT_LAST_NAME,
MEDIA,
TECHNICAL_RESULT,
RESULT_REASON,
RESOURCE_ROLE,
ROLE_REASON,
PLACE,
UD_langue,
UD_vipgsm,
UD_vipomy,
UD_isomy,
UD_ListSegment,
UD_segment,
UD_site_cible,
UD_site_choisi,
UD_comp,
UD_comp_deb,
UD_comp_choisi,
UD_TYPE_CC,
UD_crise_site,
UD_crise_ferm,
UD_crise_flux,
UD_crise_dissu,
UD_distributed,
UD_nRONA,
UD_HNO,
UD_Xfer_Presta,
UD_Fermeture,
UD_Dissuasion,
UD_DNIS,
UD_DureeAttente,
UD_PrioriteFlux,
UD_ANI,
TARGET,
SHORT_ABD_FLAG,
TPS_RP,
TPS_ACW,
TPS_SONNERIE,
TPS_CONVERSATION_AGENT,
TPS_CONVERSATION_CLIENT,
HOLD_DURATION,
ORIGINAL_FILE_NAME,
ORIGINAL_FILE_SIZE,
ORIGINAL_FILE_LINE_COUNT,
CURRENT_TIMESTAMP() INSERT_DATE,
TO_DATE(FROM_UNIXTIME(UNIX_TIMESTAMP(SUBSTRING(ORIGINAL_FILE_NAME, -19, 8),'yyyyMMdd'))) FILE_DATE
FROM CTI.TT_STAT_AGENT_CTI C
LEFT JOIN (SELECT DISTINCT ORIGINAL_FILE_NAME FILE_NAME FROM CTI.IT_STAT_AGENT_CTI WHERE FILE_DATE BETWEEN DATE_SUB(CURRENT_DATE,2) AND CURRENT_DATE) T ON T.FILE_NAME=C.ORIGINAL_FILE_NAME
WHERE T.FILE_NAME IS NULL
