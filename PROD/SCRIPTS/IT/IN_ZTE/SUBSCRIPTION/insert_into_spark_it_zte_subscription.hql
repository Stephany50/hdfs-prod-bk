INSERT INTO CDR.SPARK_IT_ZTE_SUBSCRIPTION PARTITION (CREATEDDATE,FILE_DATE)
SELECT
  ACC_NBR ,
  CHANNEL_ID,
  SUBS_EVENT_ID	,
  CREATEDDATE NQ_CREATEDDATE,
  OLD_SUBS_STATE,
  NEW_SUBS_STATE,
  EVENT_COST,
  BENEFIT_NAME,
  BENEFIT_BAL_LIST,
  OLD_PROD_SPEC_CODE,
  PROD_SPEC_CODE,
  OLD_PRICE_PLAN_CODE,
  PRICE_PLAN_CODE,
  OLD_RELATED_PROD_CODE,
  RELATED_PROD_CODE,
  ACTIVE_DATE,
  EXPIRED_DATE,
  PROVIDER_ID,
  PREPAY_FLAG,
  PAYMENT_NUMBER,
  SUBSCRIPTION_COST,
  TRANSACTIONSN,
  ORIGINAL_FILE_NAME,
  TO_DATE(FROM_UNIXTIME(UNIX_TIMESTAMP(SUBSTRING (ORIGINAL_FILE_NAME, -19, 8),'yyyyMMdd'))) ORIGINAL_FILE_DATE,
  ORIGINAL_FILE_SIZE,
  ORIGINAL_FILE_LINE_COUNT,
  CURRENT_TIMESTAMP() INSERT_DATE,
  EXP_LAC,
  EXP_CELL_ID,
  BAL_ID,
  REQUEST_ID,
  TO_DATE(CREATEDDATE) CREATEDDATE,
  TO_DATE(FROM_UNIXTIME(UNIX_TIMESTAMP(SUBSTRING (ORIGINAL_FILE_NAME, -19, 8),'yyyyMMdd'))) FILE_DATE
FROM CDR.TT_ZTE_SUBSCRIPTION C
LEFT JOIN (SELECT DISTINCT  ORIGINAL_FILE_NAME FILE_NAME FROM CDR.SPARK_IT_ZTE_SUBSCRIPTION WHERE CREATEDDATE BETWEEN DATE_SUB(CURRENT_DATE,3) AND CURRENT_DATE )T ON T.FILE_NAME=C.ORIGINAL_FILE_NAME
WHERE T.FILE_NAME IS NULL
