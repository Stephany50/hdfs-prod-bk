INSERT INTO TMP.TT_BDI_TMP 


SELECT

nvl(a.MSISDN, b.MSISDN) MSISDN,

IF(a.msisdn IS NULL OR b.msisdn IS NULL, nvl(a.DATE_ACTIVATION,b.DATE_ACTIVATION),TRIM(b.DATE_ACTIVATION)) DATE_ACTIVATION,  

IF(a.msisdn IS NULL OR b.msisdn IS NULL, nvl(a.STATUT,b.STATUT),TRIM(b.STATUT)) STATUT,

IF(a.msisdn IS NULL OR b.msisdn IS NULL, nvl(a.RAISON_STATUT,b.RAISON_STATUT),TRIM(b.RAISON_STATUT)) RAISON_STATUT,

IF(a.msisdn IS NULL OR b.msisdn IS NULL, nvl(a.COMPTE_CLIENT,b.COMPTE_CLIENT),TRIM(b.COMPTE_CLIENT)) COMPTE_CLIENT,

IF(a.msisdn IS NULL OR b.msisdn IS NULL, nvl(a.COMPTE_CLIENT_STRUCTURE,b.COMPTE_CLIENT_STRUCTURE),TRIM(b.COMPTE_CLIENT_STRUCTURE)) COMPTE_CLIENT_STRUCTURE,

IF(a.msisdn IS NULL OR b.msisdn IS NULL, nvl(a.NOM_STRUCTURE,b.NOM_STRUCTURE),TRIM(b.NOM_STRUCTURE))NOM_STRUCTURE,

IF(a.msisdn IS NULL OR b.msisdn IS NULL, nvl(a.NUMERO_REGISTRE_COMMERCE,b.NUMERO_REGISTRE_COMMERCE),TRIM(b.NUMERO_REGISTRE_COMMERCE))NUMERO_REGISTRE_COMMERCE,

IF(a.msisdn IS NULL OR b.msisdn IS NULL, nvl(a.NUMERO_PIECE_REPRESENTANT_LEGAL,b.NUMERO_PIECE_REPRESENTANT_LEGAL),TRIM(b.NUMERO_PIECE_REPRESENTANT_LEGAL)) NUMERO_PIECE_REPRESENTANT_LEGAL,

IF(a.msisdn IS NULL OR b.msisdn IS NULL, nvl(a.ID_TYPE_PIECE,b.ID_TYPE_PIECE),TRIM(b.ID_TYPE_PIECE))ID_TYPE_PIECE,

IF(a.msisdn IS NULL OR b.msisdn IS NULL, nvl(a.NUMERO_PIECE,b.NUMERO_PIECE), TRIM(b.NUMERO_PIECE))NUMERO_PIECE,

IF(a.msisdn IS NULL OR b.msisdn IS NULL, nvl(a.NOM,b.NOM),TRIM(b.NOM))NOM,

IF(a.msisdn IS NULL OR b.msisdn IS NULL, nvl(a.PRENOM,b.PRENOM),TRIM(b.PRENOM))PRENOM,

IF(a.msisdn IS NULL OR b.msisdn IS NULL, nvl(a.DATE_NAISSANCE,b.DATE_NAISSANCE),TRIM(b.DATE_NAISSANCE)) DATE_NAISSANCE,

IF(a.msisdn IS NULL OR b.msisdn IS NULL, nvl(a.DATE_EXPIRATION,b.DATE_EXPIRATION),TRIM(b.DATE_EXPIRATION)) DATE_EXPIRATION,

IF(a.msisdn IS NULL OR b.msisdn IS NULL, nvl(a.VILLE,b.VILLE),TRIM(b.VILLE)) VILLE,

IF(a.msisdn IS NULL OR b.msisdn IS NULL, nvl(a.ADRESSE,a.ADRESSE),TRIM(b.ADRESSE)) ADRESSE,

IF(a.msisdn IS NULL OR b.msisdn IS NULL, nvl(a.ID_TYPE_PIECE_TUTEUR,b.ID_TYPE_PIECE_TUTEUR),TRIM(b.ID_TYPE_PIECE_TUTEUR)) ID_TYPE_PIECE_TUTEUR,

IF(a.msisdn IS NULL OR b.msisdn IS NULL, nvl(a.NUMERO_PIECE_TUTEUR,b.NUMERO_PIECE_TUTEUR),TRIM(b.NUMERO_PIECE_TUTEUR)) NUMERO_PIECE_TUTEUR,

IF(a.msisdn IS NULL OR b.msisdn IS NULL, nvl(a.PRENOM_TUTEUR,b.PRENOM_TUTEUR),TRIM(b.PRENOM_TUTEUR)) PRENOM_TUTEUR,

IF(a.msisdn IS NULL OR b.msisdn IS NULL, nvl(a.NOM_TUTEUR,a.NOM_TUTEUR),TRIM(b.NOM_TUTEUR)) NOM_TUTEUR,

IF(a.msisdn IS NULL OR b.msisdn IS NULL, nvl(a.DATE_NAISSANCE_TUTEUR,b.DATE_NAISSANCE_TUTEUR),TRIM(b.DATE_NAISSANCE_TUTEUR)) DATE_NAISSANCE_TUTEUR,

IF(a.msisdn IS NULL OR b.msisdn IS NULL, nvl(a.CCMODDATE,b.CCMODDATE),TRIM(b.CCMODDATE)) CCMODDATE

FROM TMP.tt_bdi_tmp_old a

FULL OUTER JOIN

(SELECT * FROM CDR.spark_it_bdi_crm where original_file_date = '2020-03-13') b

ON ( substr(trim(a.MSISDN),-9,9) = substr(trim(b.MSISDN),-9,9))