SELECT
    IF(T1.KPI_IS_LOAD=0 AND
    T2.FT_GROUP_USER_BASE>0 AND
    T3.FT_GROUP_SUBSCRIBER_SUMMARY >0 AND
    T4.FT_A_SUBSCRIBER_SUMMARY>0 AND
    T5.FT_COMMERCIAL_SUBSCRIB_SUMMARY>0 AND
    T2.nbs_ci>1000 AND
    T3.nbs_ci>1000 AND
    T4.nbs_ci>1000 AND
    T2.INSERT_COUNT=1 AND
    T3.INSERT_COUNT=1 AND
    T4.INSERT_COUNT=1 AND
    T6.SPARK_FT_SUBSCRIPTION>0 and
    T6.INSERT_COUNT=1,'OK','NOK')
 FROM
(SELECT COUNT(*) KPI_IS_LOAD FROM AGG.SPARK_FT_GLOBAL_ACTIVITY_DAILY_MKT_DG WHERE TRANSACTION_DATE='###SLICE_VALUE###' AND JOB_NAME ='COMPUTE_KPI_CUSTOMER_BASE')T1,
(SELECT COUNT(*) FT_GROUP_USER_BASE,count(distinct location_ci ) nbs_ci, COUNT(distinct INSERT_DATE) INSERT_COUNT FROM MON.SPARK_FT_GROUP_USER_BASE WHERE EVENT_DATE='###SLICE_VALUE###')T2,
(SELECT COUNT(*) FT_GROUP_SUBSCRIBER_SUMMARY,count(distinct location_ci ) nbs_ci, COUNT(distinct INSERT_DATE) INSERT_COUNT FROM MON.SPARK_FT_GROUP_SUBSCRIBER_SUMMARY WHERE EVENT_DATE= DATE_ADD('###SLICE_VALUE###',1))T3,
(SELECT COUNT(*) FT_A_SUBSCRIBER_SUMMARY,count(distinct location_ci ) nbs_ci, COUNT(distinct REFRESH_DATE) INSERT_COUNT FROM AGG.SPARK_FT_A_SUBSCRIBER_SUMMARY WHERE DATECODE='###SLICE_VALUE###')T4,
(SELECT COUNT(*) FT_COMMERCIAL_SUBSCRIB_SUMMARY,count(distinct location_ci ) nbs_ci, COUNT(distinct REFRESH_DATE) INSERT_COUNT FROM mon.spark_FT_COMMERCIAL_SUBSCRIB_SUMMARY WHERE DATECODE='###SLICE_VALUE###')T5,
(SELECT COUNT(*) SPARK_FT_SUBSCRIPTION,COUNT(distinct INSERT_date) INSERT_COUNT FROM MON.SPARK_FT_SUBSCRIPTION WHERE TRANSACTION_DATE='###SLICE_VALUE###')T6