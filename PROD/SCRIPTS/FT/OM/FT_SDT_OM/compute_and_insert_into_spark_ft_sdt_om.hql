INSERT INTO MON.SPARK_FT_SDT_OM
SELECT
    A.*,
    CURRENT_TIMESTAMP() INSERT_DATE,
    '###SLICE_VALUE###' DATE_INSCRIPT
FROM
(
    SELECT
        A0.EFF_INSCRIPTEUR,
        SUM(A0.NBR_SDT_CONFORME) NBR_SDT_CONFORME,
        SUM(A0.NBR_INSCRIPTION) NBR_INSCRIPTION,
        SUM(A0.NBR_SDT_CONFORME_CUMULE) NBR_SDT_CONFORME_CUMULE,
        SUM(A0.NBR_INSCRIPTION_CUMULE) NBR_INSCRIPTION_CUMULE
    FROM
    (
        SELECT 
            A00.INSCRIPTEUR EFF_INSCRIPTEUR,
            NVL(A00.NBR_INSCRIPTION, 0) NBR_INSCRIPTION, 
            NVL(A00.NBR_SDT_CONFORME, 0) NBR_SDT_CONFORME,
            NVL(A01.NBR_INSCRIPTION_CUMULE, 0) NBR_INSCRIPTION_CUMULE, 
            NVL(A01.NBR_SDT_CONFORME_CUMULE, 0) NBR_SDT_CONFORME_CUMULE
        FROM 
        (
            SELECT
                INSCRIPTEUR,
                COUNT(MSISDN) NBR_INSCRIPTION,
                COUNT(DISTINCT CASE WHEN REG_LEVEL = 'SDT' AND SEUIL_OK='VRAI' AND BOUCLE='FAUX' AND CONFORMITE='VRAI' THEN MSISDN END) NBR_SDT_CONFORME
            FROM TMP.TT_SDT_OM
            WHERE DATE_INSCRIPT = '###SLICE_VALUE###'
            GROUP BY INSCRIPTEUR
        ) A00
        LEFT JOIN
        (
            SELECT
                INSCRIPTEUR,
                COUNT(MSISDN) NBR_INSCRIPTION_CUMULE,
                COUNT(DISTINCT CASE  WHEN REG_LEVEL = 'SDT' AND SEUIL_OK='VRAI' AND BOUCLE='FAUX' AND CONFORMITE='VRAI' THEN MSISDN END) NBR_SDT_CONFORME_CUMULE
            FROM TMP.TT_SDT_OM
            WHERE DATE_INSCRIPT BETWEEN SUBSTR('###SLICE_VALUE###', 0, 6) || '01' AND '###SLICE_VALUE###'
            GROUP BY INSCRIPTEUR
        ) A01 ON A00.INSCRIPTEUR = A01.INSCRIPTEUR
    ) A0
    GROUP BY A0.EFF_INSCRIPTEUR
) A
