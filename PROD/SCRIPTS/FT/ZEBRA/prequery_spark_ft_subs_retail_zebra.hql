SELECT IF(A.COUNT_FT = 0 and B.COUNT_IT_ZEBRA>100 and C.COUNT_FT_SUBSCRIPTION>100 and 
ABS(B.COUNT_IT_ZEBRA/D.COUNT_IT_ZEBRA - 1) < 0.5
,"OK","NOK") FROM
    (SELECT count(*) COUNT_FT FROM MON.SPARK_FT_SUBS_RETAIL_ZEBRA WHERE TRANSACTION_DATE='###SLICE_VALUE###') A,
    (SELECT COUNT(*) COUNT_IT_ZEBRA FROM CDR.SPARK_IT_ZEBRA_TRANSAC WHERE TRANSFER_DATE='###SLICE_VALUE###') B,
    (SELECT COUNT(*) COUNT_FT_SUBSCRIPTION FROM MON.SPARK_FT_SUBSCRIPTION WHERE TRANSACTION_DATE='###SLICE_VALUE###') C,
    (SELECT COUNT(*) COUNT_IT_ZEBRA FROM CDR.SPARK_IT_ZEBRA_TRANSAC WHERE TRANSFER_DATE=date_sub('###SLICE_VALUE###', 1)) D
