insert into mon.spark_ft_msisdn_da_status_new
SELECT
	distinct ACC_NBR msisdn
	, BAL_ID 
	, ACCT_RES_NAME da_name
	, CASE
			WHEN upper(ACCT_RES_RATING_SERVICE_CODE)='TEL' THEN -(GROSS_BAL + RESERVE_BAL + CONSUME_BAL)/(100)
			WHEN upper(ACCT_RES_RATING_SERVICE_CODE)='DATA' THEN -(GROSS_BAL + RESERVE_BAL + CONSUME_BAL)/(1024*1024)
			ELSE -(GROSS_BAL + RESERVE_BAL + CONSUME_BAL)/(1)
		END volume_remaining -- TOTAL_IN_NB_OR_FCFA_OR_MB
	, ACCT_RES_RATING_SERVICE_CODE da_type
	, acct_res_rating_unit da_unit
	, BAL.EXP_DATE expiry_date
	, BAL.EFF_DATE eff_date
	, BAL.UPDATE_DATE UPDATE_DATE
	, CURRENT_TIMESTAMP() INSERT_DATE
	, '###SLICE_VALUE###' event_date
FROM CDR.SPARK_IT_ZTE_SUBS_EXTRACT SUBS
	, DIM.SPARK_DT_BALANCE_TYPE_ITEM DIM
	, ( SELECT * FROM CDR.SPARK_IT_ZTE_BAL_EXTRACT WHERE ORIGINAL_FILE_DATE = date_add('###SLICE_VALUE###', 1) ) BAL
where BAL.ACCT_ID = SUBS.ACCT_ID 
	AND BAL.ACCT_RES_ID = DIM.ACCT_RES_ID
	AND SUBS.ORIGINAL_FILE_DATE = BAL.ORIGINAL_FILE_DATE

