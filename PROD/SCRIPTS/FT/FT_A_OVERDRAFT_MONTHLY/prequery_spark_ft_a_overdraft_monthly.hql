SELECT IF(A.COUNT_FT_CONTRACT_SNAPSHOT > 0 and B.COUNT_FT_OVERDRAFT > datediff(last_day(concat('###SLICE_VALUE###','-01')), concat('###SLICE_VALUE###','-01')) AND C.COUNT_FT_OVERDRAFT_MONTHLY=0 AND D.COUNT_FT_A_OVERDRAFT_MONTHLY=0,"OK","NOK") FROM
 (SELECT COUNT(*) COUNT_FT_CONTRACT_SNAPSHOT FROM MON.SPARK_FT_CONTRACT_SNAPSHOT WHERE EVENT_DATE=ADD_MONTHS(TO_DATE(CONCAT("###SLICE_VALUE###", '-01')), 1)) A,
 (SELECT COUNT(DISTINCT TRANSACTION_DATE) COUNT_FT_OVERDRAFT FROM MON.SPARK_FT_OVERDRAFT WHERE TRANSACTION_DATE between concat('###SLICE_VALUE###','-01') and last_day(concat('###SLICE_VALUE###','-01'))) B,
 (SELECT COUNT(*) COUNT_FT_OVERDRAFT_MONTHLY FROM MON.SPARK_FT_OVERDRAFT_MONTHLY WHERE EVENT_MONTH='###SLICE_VALUE###') C,
 (SELECT COUNT(*) COUNT_FT_A_OVERDRAFT_MONTHLY FROM AGG.SPARK_FT_A_OVERDRAFT_MONTHLY WHERE EVENT_MONTH='###SLICE_VALUE###') D