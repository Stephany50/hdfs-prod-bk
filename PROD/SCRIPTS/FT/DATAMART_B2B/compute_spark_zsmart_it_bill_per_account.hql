INSERT INTO CDR.SPARK_IT_BILL_PER_ACCOUNT PARTITION (EVENT_DATE)
SELECT
    TRIM(BOTH '"' FROM BILL_TYPE_NAME)BILL_TYPE_NAME,
    CREATED_BY,
    CYCLE_TYPE,
    INVOICE_DATE,
    GENERATION_DATE,
    ACCT_NBR,
    CUST_CATEGORY,
    CUST_SEGMENT,
    SMS_NBR,
    EMAIL,
    CC_EMAIL,
    CUST_CODE,
    DEPT_NAME,
    CUST_NAME,
    BILL_NUMBER,
    BILL_AMOUNT,
    BILL_OPEN_AMOUNT,
    PRE_BALANCE,
    ENCAISSEMENTS,
    ACCOUNT_CURRENT_BALANCE,
    PREVIOUS_BILL_DUE,
    TRIM(BOTH '"' FROM VARIATION)VARIATION,
    ORIGINAL_FILE_NAME ,
    CURRENT_TIMESTAMP() INSERT_DATE,
    concat(SUBSTRING(ORIGINAL_FILE_NAME, 18,4),'-',SUBSTRING(ORIGINAL_FILE_NAME, 22,2)) ORIGINAL_FILE_DATE,
    concat(SUBSTRING(ORIGINAL_FILE_NAME, 18,4),'-',SUBSTRING(ORIGINAL_FILE_NAME, 22,2)) EVENT_DATE
FROM CDR.SPARK_TT_BILL_PER_ACCOUNT C
LEFT JOIN (SELECT DISTINCT  ORIGINAL_FILE_NAME FILE_NAME FROM CDR.SPARK_IT_RAPPORT_DAILY)T ON T.FILE_NAME=C.ORIGINAL_FILE_NAME
WHERE T.FILE_NAME IS NULL


