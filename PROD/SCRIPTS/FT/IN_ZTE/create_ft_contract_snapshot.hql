
--***********************************************************---
------------ FT Table- FT_CONTRACT_SNAPSHOT  -------------------
---***********************************************************---
CREATE TABLE IF NOT EXISTS MON.FT_CONTRACT_SNAPSHOT (
    CONTRACT_ID    INT,
    CUSTOMER_ID    INT,
    ACCESS_KEY    VARCHAR(25),
    ACCOUNT_ID    VARCHAR(25),
    ACTIVATION_DATE    DATE,
    DEACTIVATION_DATE    DATE,
    INACTIVITY_BEGIN_DATE    DATE,
    BLOCKED    VARCHAR(20),
    EXHAUSTED    VARCHAR(20),
    PERIODIC_FEE    VARCHAR(20),
    SCRATCH_RELOAD_SUSP    VARCHAR(20),
    COMMERCIAL_OFFER_ASSIGN_DATE    DATE,
    COMMERCIAL_OFFER    VARCHAR(50),
    CURRENT_STATUS    VARCHAR(20),
    STATUS_DATE    DATE,
    LOGIN    VARCHAR(25),
    LANG    VARCHAR(5),
    LOCATION    VARCHAR(50),
    MAIN_IMSI    VARCHAR(25),
    MSID_TYPE    VARCHAR(10),
    PROFILE    VARCHAR(50),
    BAD_RELOAD_ATTEMPTS    VARCHAR(5),
    LAST_TOPUP_DATE    DATE,
    LAST_CREDIT_UPDATE_DATE    DATE,
    BAD_PIN_ATTEMPTS    VARCHAR(5),
    BAD_PWD_ATTEMPTS    VARCHAR(5),
    OSP_ACCOUNT_TYPE    VARCHAR(15),
    INACTIVITY_CREDIT_LOSS    VARCHAR(5),
    DEALER_ID    INT,
    PROVISIONING_DATE    DATE,
    MAIN_CREDIT    DOUBLE,
    PROMO_CREDIT    DOUBLE,
    SMS_CREDIT    DOUBLE,
    DATA_CREDIT    DOUBLE,
    USED_CREDIT_MONTH    DOUBLE,
    USED_CREDIT_LIFE    DOUBLE,
    BUNDLE_LIST    VARCHAR(2000),
    BUNDLE_UNIT_LIST    VARCHAR(2000),
    PROMO_AND_DISCOUNT_LIST    VARCHAR(2000),
    INSERT_DATE    TIMESTAMP,
    SRC_TABLE    VARCHAR(30),
    OSP_STATUS    VARCHAR(30),
    BSCS_COMM_OFFER_ID    DOUBLE,
    BSCS_COMM_OFFER    VARCHAR(100),
    INITIAL_SELECTION_DONE    VARCHAR(20),
    NOMORE_CREDIT    VARCHAR(20),
    PWD_BLOCKED    VARCHAR(20),
    FIRST_EVENT_DONE    VARCHAR(20),
    CUST_EXT_ID    VARCHAR(50),
    CUST_GROUP    VARCHAR(50),
    CUST_CATEGORY    VARCHAR(50),
    CUST_BILLCYCLE    VARCHAR(50),
    CUST_SEGMENT    VARCHAR(50),
    OSP_CONTRACT_TYPE    VARCHAR(50),
    OSP_CUST_COMMERCIAL_OFFER    VARCHAR(50)  ,
    OSP_CUSTOMER_CGLIST    VARCHAR(50),
    OSP_CUSTOMER_FORMULE    VARCHAR(50),
    BSCS_ACTIVATION_DATE    DATE,
    BSCS_DEACTIVATION_DATE    DATE,
    OPERATOR_CODE    VARCHAR(10),
    BALANCE_LIST    VARCHAR(3000),
    PREVIOUS_STATUS    VARCHAR(50),
    CURRENT_STATUS_1    VARCHAR(50),
    STATE_DATETIME    DATE
) COMMENT 'FT des CRA MSC'
PARTITIONED BY (EVENT_DATE    DATE)
STORED AS ORC TBLPROPERTIES ("orc.compress"="ZLIB","orc.stripe.size"="67108864")
;


INSERT INTO tmp.FT_CONTRACT_SNAPSHOT SELECT
CONTRACT_ID,
CUSTOMER_ID,
ACCESS_KEY,
ACCOUNT_ID,
ACTIVATION_DATE,
DEACTIVATION_DATE,
INACTIVITY_BEGIN_DATE,
BLOCKED,
EXHAUSTED,
PERIODIC_FEE,
SCRATCH_RELOAD_SUSP,
COMMERCIAL_OFFER_ASSIGN_DATE,
COMMERCIAL_OFFER,
CURRENT_STATUS,
STATUS_DATE,
LOGIN,
LANG,
LOCATION,
MAIN_IMSI,
MSID_TYPE,
PROFILE,
BAD_RELOAD_ATTEMPTS,
LAST_TOPUP_DATE,
LAST_CREDIT_UPDATE_DATE,
BAD_PIN_ATTEMPTS,
BAD_PWD_ATTEMPTS,
OSP_ACCOUNT_TYPE,
INACTIVITY_CREDIT_LOSS,
DEALER_ID,
PROVISIONING_DATE,
MAIN_CREDIT,
PROMO_CREDIT,
SMS_CREDIT,
DATA_CREDIT,
USED_CREDIT_MONTH,
USED_CREDIT_LIFE,
BUNDLE_LIST,
BUNDLE_UNIT_LIST,
PROMO_AND_DISCOUNT_LIST,
INSERT_DATE,
SRC_TABLE,
OSP_STATUS,
BSCS_COMM_OFFER_ID,
BSCS_COMM_OFFER,
INITIAL_SELECTION_DONE,
NOMORE_CREDIT,
PWD_BLOCKED,
FIRST_EVENT_DONE,
CUST_EXT_ID,
CUST_GROUP,
CUST_CATEGORY,
CUST_BILLCYCLE,
CUST_SEGMENT,
OSP_CONTRACT_TYPE,
OSP_CUST_COMMERCIAL_OFFER  ,
OSP_CUSTOMER_CGLIST,
OSP_CUSTOMER_FORMULE,
BSCS_ACTIVATION_DATE,
BSCS_DEACTIVATION_DATE,
OPERATOR_CODE,
BALANCE_LIST,
PREVIOUS_STATUS,
CURRENT_STATUS_1,
STATE_DATETIME,
to_date(EVENT_DATE)
from backup_dwh.ft_contract_snapshot_20190901_0831