
insert into AGG.SPARK_FT_GLOBAL_ACTIVITY_DAILY_MKT
select
    'USER_GROSS_ADD' DESTINATION_CODE,
    COMMERCIAL_OFFER PROFILE_CODE,
    'UNKNOWN' SUB_ACCOUNT,
    'HIT' MEASUREMENT_UNIT
    ,'FT_A_SUBSCRIBER_SUMMARY' SOURCE_TABLE,
    NVL(OPERATOR_CODE,'OCM')OPERATOR_CODE ,
    sum(TOTAL_ACTIVATION) TOTAL_AMOUNT,
    sum(TOTAL_ACTIVATION) RATED_AMOUNT
    ,CURRENT_TIMESTAMP INSERT_DATE,
    '' REGION_ID,
    datecode TRANSACTION_DATE
from AGG.SPARK_FT_A_SUBSCRIBER_SUMMARY a
LEFT JOIN DIM.DT_OFFER_PROFILES b ON  upper(a.COMMERCIAL_OFFER) = b.PROFILE_CODE
WHERE datecode>='2020-04-01' and datecode not in ('2020-04-01','2020-04-04','2020-04-05','2020-04-08','2020-04-09','2020-04-12','2020-04-13','2020-04-16','2020-04-17','2020-04-20','2020-04-21','2020-04-24','2020-04-25','2020-04-27','2020-04-28','2020-04-29') and NETWORK_DOMAIN = 'GSM'
group by datecode,COMMERCIAL_OFFER,NVL(OPERATOR_CODE,'OCM')

WHERE transaction_date>='2020-04-01' and transaction_date not in ('2020-04-01','2020-04-04','2020-04-05','2020-04-08','2020-04-09','2020-04-12','2020-04-13','2020-04-16','2020-04-17','2020-04-20','2020-04-21','2020-04-24','2020-04-25','2020-04-27','2020-04-28','2020-04-29') and NETWORK_DOMAIN = 'GSM'


insert into AGG.SPARK_FT_GLOBAL_ACTIVITY_DAILY_MKT
select
    'USER_GROUP' DESTINATION_CODE,
    PROFILE PROFILE_CODE,
    'UNKNOWN' SUB_ACCOUNT,
    'HIT' MEASUREMENT_UNIT
    ,'FT_GROUP_SUBSCRIBER_SUMMARY' SOURCE_TABLE,
    NVL(b.OPERATOR_CODE,'OCM')OPERATOR_CODE ,
    sum(EFFECTIF) TOTAL_AMOUNT,
    sum(EFFECTIF) RATED_AMOUNT
    ,CURRENT_TIMESTAMP INSERT_DATE,
    '' REGION_ID,
    DATE_SUB(event_date,1) TRANSACTION_DATE
from MON.SPARK_FT_GROUP_SUBSCRIBER_SUMMARY  a
LEFT JOIN DIM.DT_OFFER_PROFILES b on upper(a.PROFILE) = b.PROFILE_CODE
where event_date >='2020-04-01' and   DATE_SUB(event_date,1) not in ('2020-04-02','2020-04-03','2020-04-06','2020-04-07','2020-04-10','2020-04-11','2020-04-14','2020-04-15','2020-04-18','2020-04-19','2020-04-22','2020-04-23','2020-04-26','2020-04-27','2020-04-28','2020-04-29') and  statut = 'ACTIF' and CUST_BILLCYCLE in ( 'PURE PREPAID','HYBRID')
group by
    EVENT_DATE,
    profile,
    NVL(b.OPERATOR_CODE,'OCM')

where TRANSACTION_DATE >='2020-04-01' and   TRANSACTION_DATE not in ('2020-04-02','2020-04-03','2020-04-06','2020-04-07','2020-04-10','2020-04-11','2020-04-14','2020-04-15','2020-04-18','2020-04-19','2020-04-22','2020-04-23','2020-04-26','2020-04-27','2020-04-28','2020-04-29') and  statut = 'ACTIF' and CUST_BILLCYCLE in ( 'PURE PREPAID','HYBRID')

create table tmp.global_activity_mkt3 as
select TRANSACTION_DATE,DESTINATION_CODE,PROFILE_CODE,SUB_ACCOUNT,MEASUREMENT_UNIT,SOURCE_TABLE,OPERATOR_CODE,TOTAL_AMOUNT,RATED_AMOUNT,INSERT_DATE,REGION_ID  from agg.spark_ft_global_activity_daily_mkt where TRANSACTION_DATE >='2020-04-01' and   TRANSACTION_DATE not in ('2020-04-02','2020-04-03','2020-04-06','2020-04-07','2020-04-10','2020-04-11','2020-04-14','2020-04-15','2020-04-18','2020-04-19','2020-04-22','2020-04-23','2020-04-26','2020-04-27','2020-04-28','2020-04-29')
and source_table in ('FT_GROUP_SUBSCRIBER_SUMMARY');
