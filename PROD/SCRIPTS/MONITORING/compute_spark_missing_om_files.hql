INSERT INTO  MON.SPARK_MISSING_OM_FILES

SELECT C.* FROM (SELECT 'OTHER_OM' TABLE_SOURCE,'NORMAL' FLUX_TYPE,'/PROD/RAW/OM/' RAWDIR,'ALLBALANCE' HDDFS_SUBDIR,'1' NB_HEADER_MOVE,'|' CSV_SEPARAROR,'OM_ALL_BALANCE' FLUX_NAME,CONCAT('AllBalance','_',DATE_FORMAT('2020-03-24','YYYYMMdd'),'.','csv') FILE_NAME, CURRENT_TIMESTAMP INSERT_DATE,'2020-03-24' ORIGINAL_FILE_DATE )C
LEFT JOIN (SELECT DISTINCT ORIGINAL_FILE_NAME FROM CDR.SPARK_IT_OM_ALL_BALANCE B WHERE ORIGINAL_FILE_DATE ='2020-03-24') B ON SUBSTRING(B.ORIGINAL_FILE_NAME,-12,8) = SUBSTRING(C.FILE_NAME,-12,8)
WHERE B.ORIGINAL_FILE_NAME IS NULL
UNION
SELECT C.* FROM (SELECT 'APGL' TABLE_SOURCE,'NORMAL' FLUX_TYPE,'/PROD/RAW/OM/' RAWDIR,'GL_TRX_INTERFACE' HDDFS_SUBDIR,'4' NB_HEADER_MOVE,'|' CSV_SEPARAROR,'OM_APGL' FLUX_NAME,CONCAT('GL_TRX_INTERFACE','_',DATE_FORMAT('2020-03-24','YYYYMMdd'),'.','csv') FILE_NAME, CURRENT_TIMESTAMP INSERT_DATE,'2020-03-24' ORIGINAL_FILE_DATE )C
LEFT JOIN (SELECT DISTINCT ORIGINAL_FILE_NAME FROM CDR.SPARK_IT_OM_APGL B WHERE TRANSACTION_DATE =  '2020-03-24' and TO_DATE(ORIGINAL_FILE_DATE) = '2020-03-24') B ON SUBSTRING(B.ORIGINAL_FILE_NAME,-12,8) = SUBSTRING(C.FILE_NAME,-12,8)
WHERE B.ORIGINAL_FILE_NAME IS NULL
UNION
SELECT C.* FROM (SELECT 'OTHER_OM' TABLE_SOURCE,'NORMAL' FLUX_TYPE,'/PROD/RAW/OM/' RAWDIR,'COMMISSIONSDETAILS' HDDFS_SUBDIR,'1' NB_HEADER_MOVE,'|' CSV_SEPARAROR,'OM_COMMISSIONS_DETAILS' FLUX_NAME,CONCAT('CommissionsDetails','_',DATE_FORMAT('2020-03-24','YYYYMMdd'),'.','csv') FILE_NAME, CURRENT_TIMESTAMP INSERT_DATE,'2020-03-24' ORIGINAL_FILE_DATE )C
LEFT JOIN (SELECT DISTINCT ORIGINAL_FILE_NAME FROM CDR.SPARK_IT_OMNY_COMMISSION_DETAILS B WHERE TRANSACTION_DATE = '2020-03-24' and TO_DATE(ORIGINAL_FILE_DATE) = '2020-03-24') B ON SUBSTRING(B.ORIGINAL_FILE_NAME,-12,8) = SUBSTRING(C.FILE_NAME,-12,8)
WHERE B.ORIGINAL_FILE_NAME IS NULL
UNION
SELECT C.* FROM (SELECT 'OTHER_OM' TABLE_SOURCE,'NORMAL' FLUX_TYPE,'/PROD/RAW/OM/' RAWDIR,'SERVICESCHARGESDETAILS' HDDFS_SUBDIR,'1' NB_HEADER_MOVE,'|' CSV_SEPARAROR,'OM_SERVICES_CHARGES_DETAILS' FLUX_NAME,CONCAT('ServicesChargesDetails','_',DATE_FORMAT('2020-03-24','YYYYMMdd'),'.','csv') FILE_NAME, CURRENT_TIMESTAMP INSERT_DATE,'2020-03-24' ORIGINAL_FILE_DATE )C
LEFT JOIN (SELECT DISTINCT ORIGINAL_FILE_NAME FROM CDR.SPARK_IT_OMNY_SERVICES_CHARGES_DETAILS B WHERE TRANSACTION_DATE = '2020-03-24' and TO_DATE(ORIGINAL_FILE_DATE) = '2020-03-24') B ON SUBSTRING(B.ORIGINAL_FILE_NAME,-12,8) = SUBSTRING(C.FILE_NAME,-12,8)
WHERE B.ORIGINAL_FILE_NAME IS NULL
UNION
SELECT C.* FROM (SELECT 'OTHER_OM' TABLE_SOURCE,'NORMAL' FLUX_TYPE,'/PROD/RAW/OM/' RAWDIR,'SUBSCRIBERS' HDDFS_SUBDIR,'1' NB_HEADER_MOVE,'|' CSV_SEPARAROR,'OM_SUBSCRIBERS' FLUX_NAME,CONCAT('Subscribers','_',DATE_FORMAT('2020-03-24','YYYYMMdd'),'.','csv') FILE_NAME, CURRENT_TIMESTAMP INSERT_DATE,'2020-03-24' ORIGINAL_FILE_DATE )C
LEFT JOIN (SELECT DISTINCT ORIGINAL_FILE_NAME FROM CDR.SPARK_IT_OM_SUBSCRIBERS B WHERE MODIFICATION_DATE = '2020-03-24' and TO_DATE(ORIGINAL_FILE_DATE) = '2020-03-24') B ON SUBSTRING(B.ORIGINAL_FILE_NAME,-12,8) = SUBSTRING(C.FILE_NAME,-12,8)
WHERE B.ORIGINAL_FILE_NAME IS NULL
UNION
SELECT C.* FROM (SELECT 'OTHER_OM' TABLE_SOURCE,'NORMAL' FLUX_TYPE,'/PROD/RAW/OM/' RAWDIR,'TRANSACTIONS' HDDFS_SUBDIR,'1' NB_HEADER_MOVE,'|' CSV_SEPARAROR ,'OM_TRANSACTIONS' FLUX_NAME,CONCAT('Transactions','_',DATE_FORMAT('2020-03-24','YYYYMMdd'),'.','csv') FILE_NAME, CURRENT_TIMESTAMP INSERT_DATE,'2020-03-24' ORIGINAL_FILE_DATE )C
LEFT JOIN (SELECT DISTINCT ORIGINAL_FILE_NAME FROM CDR.SPARK_IT_OMNY_TRANSACTIONS B WHERE TRANSFER_DATETIME = '2020-03-24' and TO_DATE(FILE_DATE) = '2020-03-24') B ON SUBSTRING(B.ORIGINAL_FILE_NAME,-12,8) = SUBSTRING(C.FILE_NAME,-12,8)
WHERE B.ORIGINAL_FILE_NAME IS NULL
UNION
SELECT C.* FROM (SELECT 'OTHER_OM' TABLE_SOURCE,'NORMAL' FLUX_TYPE,'/PROD/RAW/OM/' RAWDIR,'COMMISSION' HDDFS_SUBDIR,'1' NB_HEADER_MOVE,'|' CSV_SEPARAROR ,'OM_COMMISSION' FLUX_NAME,CONCAT('Commission','_',DATE_FORMAT('2020-03-24','YYYYMMdd'),'.','csv') FILE_NAME, CURRENT_TIMESTAMP INSERT_DATE,'2020-03-24' ORIGINAL_FILE_DATE )C
LEFT JOIN (SELECT DISTINCT ORIGINAL_FILE_NAME FROM CDR.SPARK_IT_OMNY_COMMISSION B WHERE transaction_date = '2020-03-24' and TO_DATE(ORIGINAL_FILE_DATE) = '2020-03-24') B ON SUBSTRING(B.ORIGINAL_FILE_NAME,-12,8) = SUBSTRING(C.FILE_NAME,-12,8)
WHERE B.ORIGINAL_FILE_NAME IS NULL