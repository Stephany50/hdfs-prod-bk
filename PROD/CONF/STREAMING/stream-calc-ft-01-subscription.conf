flux.yarn.queue = "PROD"
flux.log-level = "INFO"

flux.name = "STREAM_CALC_FT_01_SUBSCRIPTION"

flux.setup-conf += {"key": "spark.sql.shuffle.partitions", "value": "5"}

flux.streaming-backpressure-enabled = true
flux.streaming-backpressure-initialRate = 1000
flux.streaming-backpressure-maxRate = 30000

spark.streaming.kafka.maxRatePerPartition = 1000

flux.input-type = "KAFKA"
flux.output-type = "KAFKA"

flux.input-file-format = "CSV"

flux.kafka.bootstrap-servers = "edge01.adcm.orangecm:6667,edge02.adcm.orangecm:6667"
flux.kafka.subscribe = "in-zte-subscription"
flux.kafka.security-protocol = "SASL_PLAINTEXT"
flux.kafka.startingOffsets = "earliest"

flux.kafka.output-topic = "ft-01-subscription"
flux.kafka.key-expression = "CAST(TRANSACTION_DATE AS STRING) AS key"
flux.kafka.value-expression = "CAST(VALUE AS STRING) AS value"

flux.input-schema += {"field": "acc_nbr", "type": "string"}
flux.input-schema += {"field": "channel_id", "type": "integer"}
flux.input-schema += {"field": "subs_event_id", "type": "integer"}
flux.input-schema += {"field": "createddate", "type": "timestamp", "format": "yyyy-MM-dd HH:mm:ss"}
flux.input-schema += {"field": "old_subs_state", "type": "string"}
flux.input-schema += {"field": "new_subs_state", "type": "string"}
flux.input-schema += {"field": "event_cost", "type": "double"}
flux.input-schema += {"field": "benefit_name", "type": "string"}
flux.input-schema += {"field": "benefit_bal_list", "type": "string"}
flux.input-schema += {"field": "old_prod_spec_code", "type": "string"}
flux.input-schema += {"field": "prod_spec_code", "type": "string"}
flux.input-schema += {"field": "old_price_plan_code", "type": "string"}
flux.input-schema += {"field": "price_plan_code", "type": "string"}
flux.input-schema += {"field": "old_related_prod_code", "type": "string"}
flux.input-schema += {"field": "related_prod_code", "type": "string"}
flux.input-schema += {"field": "active_date", "type": "timestamp", "format": "yyyy-MM-dd HH:mm:ss"}
flux.input-schema += {"field": "expired_date", "type": "timestamp", "format": "yyyy-MM-dd HH:mm:ss"}
flux.input-schema += {"field": "provider_id", "type": "integer"}
flux.input-schema += {"field": "prepay_flag", "type": "integer"}

flux.separator = "\\|"
flux.temp-table-name = "in_zte_subscription_stream"

flux.has-watermark = "true"
flux.watermark-eventtime-column = "createddate"
flux.watermark-delay-threshold = "60 minutes"

flux.has-window = "true"
flux.window-timecolumn = "createddate"
flux.window-windowDuration = "15 minutes"
flux.window-slideDuration = "15 minutes"
flux.window-startTime = "0 second"

flux.streaming-output-mode = "update"
flux.streaming-trigger-time = "60 seconds"

flux.stream-query = "/PROD/SCRIPTS/STREAMING/stream-calc-ft-01-subscription.hql"
flux.stream-query-name = "StreamingFT01Subscription"