flux.yarn.queue = "PROD"
flux.log-level = "INFO"

flux.name = "STREAM_CALC_FT_A_SUBSCRIPTION"

flux.setup-conf += {"key": "spark.sql.shuffle.partitions", "value": "5"}

flux.streaming-backpressure-enabled = true
flux.streaming-backpressure-initialRate = 1000
flux.streaming-backpressure-maxRate = 30000

spark.streaming.kafka.maxRatePerPartition = 1000

flux.input-type = "KAFKA"
flux.output-type = "JDBC"

flux.input-file-format = "CSV"

flux.kafka.bootstrap-servers = "edge01.adcm.orangecm:6667,edge02.adcm.orangecm:6667"
flux.kafka.subscribe = "ft-subscription"
flux.kafka.security-protocol = "SASL_PLAINTEXT"
flux.kafka.startingOffsets = "latest"

flux.input-schema += {"field": "transaction_date", "type": "timestamp", "format": "yyyy-MM-dd HH:mm:ss"}
flux.input-schema += {"field": "transaction_time", "type": "string"}
flux.input-schema += {"field": "served_party_msisdn", "type": "string"}
flux.input-schema += {"field": "contract_type", "type": "string"}
flux.input-schema += {"field": "commercial_offer", "type": "string"}
flux.input-schema += {"field": "operator_code", "type": "string"}
flux.input-schema += {"field": "subscription_channel", "type": "string"}
flux.input-schema += {"field": "service_list", "type": "string"}
flux.input-schema += {"field": "subscription_service", "type": "string"}
flux.input-schema += {"field": "subscription_service_details", "type": "string"}
flux.input-schema += {"field": "subscription_related_service", "type": "string"}
flux.input-schema += {"field": "rated_amount", "type": "double"}
flux.input-schema += {"field": "price_plan_code", "type": "string"}
flux.input-schema += {"field": "main_balance_used", "type": "string"}
flux.input-schema += {"field": "active_date", "type": "timestamp", "format": "yyyy-MM-dd HH:mm:ss"}
flux.input-schema += {"field": "active_time", "type": "string"}
flux.input-schema += {"field": "expired_date", "type": "timestamp", "format": "yyyy-MM-dd HH:mm:ss"}
flux.input-schema += {"field": "expired_time", "type": "string"}
flux.input-schema += {"field": "subscription_status", "type": "string"}
flux.input-schema += {"field": "previous_commercial_offer", "type": "string"}
flux.input-schema += {"field": "previous_status", "type": "string"}
flux.input-schema += {"field": "previous_subs_service_details", "type": "string"}
flux.input-schema += {"field": "previous_subs_related_service", "type": "string"}
flux.input-schema += {"field": "benefit_balance_list", "type": "string"}
flux.input-schema += {"field": "benefit_unit_list", "type": "string"}
flux.input-schema += {"field": "benefit_added_value_list", "type": "string"}
flux.input-schema += {"field": "benefit_result_value_list", "type": "string"}
flux.input-schema += {"field": "benefit_active_date_list", "type": "string"}
flux.input-schema += {"field": "benefit_expire_date_list", "type": "string"}
flux.input-schema += {"field": "total_occurence", "type": "integer"}
flux.input-schema += {"field": "service_code", "type": "string"}
flux.input-schema += {"field": "amount_voice_onnet", "type": "double"}
flux.input-schema += {"field": "amount_voice_offnet", "type": "double"}
flux.input-schema += {"field": "amount_voice_inter", "type": "double"}
flux.input-schema += {"field": "amount_voice_roaming", "type": "double"}
flux.input-schema += {"field": "amount_sms_onnet", "type": "double"}
flux.input-schema += {"field": "amount_sms_offnet", "type": "double"}
flux.input-schema += {"field": "amount_sms_inter", "type": "double"}
flux.input-schema += {"field": "amount_sms_roaming", "type": "double"}
flux.input-schema += {"field": "amount_data", "type": "double"}
flux.input-schema += {"field": "amount_sva", "type": "double"}

flux.separator = ";"
flux.temp-table-name = "in_ft_subscription"

flux.has-watermark = "true"
flux.watermark-eventtime-column = "transaction_date"
flux.watermark-delay-threshold = "60 minutes"

flux.has-window = "true"
flux.window-timecolumn = "transaction_date"
flux.window-windowDuration = "15 minutes"
flux.window-slideDuration = "15 minutes"
flux.window-startTime = "0 second"

flux.streaming-output-mode = "update"
flux.streaming-trigger-time = "300 seconds"

flux.stream-query = "/PROD/SCRIPTS/STREAMING/stream-calc-ft-a-subscription.hql"
flux.stream-query-name = "StreamingFTASubscription"

flux.jdbc.output-url = "jdbc:mysql://172.21.66.236/monitoring_bigdata?allowMultiQueries=true&useUnicode=true&serverTimezone=UTC"
flux.jdbc.output-username = "user_mon"
flux.jdbc.output-password = "user_mon"
flux.jdbc.output-driver = "com.mysql.jdbc.Driver"
flux.jdbc.output-db-table = "daily_subs_activity"
